<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twin Racer Booster</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@2.0.6/dist/tonconnect-ui.min.js"></script>
    <script src="tg.js" defer></script>
    <script src="api.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/tonweb@0.0.41/dist/tonweb.js"></script>
    <link rel="stylesheet" href="./styles/leaderboard.css">
    <link rel="stylesheet" href="./styles/booster.css">
    
</head>
<body>
    <header>
        <div class="header-container">
            <img src="images/back_button.png"home-button" onclick="window.location.href='index.html'">
            <h1 class="game-title">Twin Racer</h1>
            <p class="tagline">Auto-Farmer</p>
        </div>
    </header>
    
    <main class="main-content">
        <video autoplay loop muted playsinline>
            <source src="./images/Auto-Farmer4.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div class="purchase-info" id="purchaseInfo">
            Purchase Speed Booster for 0.1.<br>
            It will increase your max speed by 5%.
        </div>
        <div class="quest-item">
            <div id="ton-connect"></div>
        </div>
        <button class="purchase-button" id="purchaseButtonBooster" onclick="purchaseBooster()">Purchase Booster</button>
        
    </main>

    <footer>
        <div class="footer-container">
            <p>Follow Us</p>
            <div class="social-icons">
                <a href="https://www.tiktok.com/@twin_racer" target="_blank"><img src="images/Icon_TikTok.png" alt="TikTok"></a>
                <a href="https://x.com/twin_race" target="_blank"><img src="images/Icon_X.png" alt="X (formerly Twitter)"></a>
                <a href="https://discord.gg/852Vr8S5Sf" target="_blank"><img src="images/Icon_Discord.png" alt="Discord"></a>
            </div>
        </div>
    </footer>

    <script>
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://racer.twinfinance.io/tonconnect-manifest.json',
            buttonRootId: 'ton-connect'
        });
        tonConnectUI.uiOptions = {
            twaReturnUrl: 'https://t.me/TwinRacer_bot/TwinRacer?startapp'
        };

        async function purchaseBooster(){
            userD = await userData(tgID)
            boosterLevel = userD.boosterLevel
            console.log(boosterLevel)
            r = await sendTonTransaction(200000)
            console.log(r)
            if (r.success) {
                trxID = r.trxID
                data = await doBuyBooster(tgID,boosterLevel+1,trxID) 
                console.log(data)
                if (data.message.startsWith('Booster purchase done:')){
                    loadBoosterData()
                }
            }
            
            //trxID = "1234"
            
        }


        async function loadBoosterData(){
            console.log('LoadingBoosterData')
        }

        window.onload = () => {
            tgID = 458176513
            const intervalId = setInterval(() => {
                if (tgID) {
                    userD = userData(tgID)
                    boosterLevel = userD.boosterLevel 
                    console.log(boosterLevel)
                    clearInterval(intervalId);
                } else {
                    console.log("Waiting for tgID to be initialized...");
                }
            }, 100); // Check every 100ms
        };
    </script>
</body>
</html>
